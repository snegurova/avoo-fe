name: CI
on:
push:
branches: [ main, master ]
pull_request:
branches: [ main, master ]


jobs:
build:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v4


- name: Enable Corepack (Yarn Berry)
run: corepack enable


- name: Use Node.js 20
uses: actions/setup-node@v4
with:
node-version: 20


- name: Prepare Yarn
run: corepack prepare yarn@4.3.1 --activate


- name: Cache Yarn & Turbo
uses: actions/cache@v4
with:
path: |
.yarn/cache
.turbo
key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock', '.yarnrc.yml') }}-turbo-${{ hashFiles('turbo.json') }}
restore-keys: |
${{ runner.os }}-yarn-
${{ runner.os }}-turbo-


- name: Install dependencies
run: yarn install --immutable


- name: Lint
run: npx turbo run lint


- name: Typecheck
run: npx turbo run typecheck


- name: Test
run: npx turbo run test


- name: Prettier check
run: yarn prettier --check .


- name: Build
run: npx turbo run build --cache-dir=.turbo
